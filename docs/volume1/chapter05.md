# 第5話：「感情をコードに」

「プログラミング言語に感情って必要ですか？」

　研究室のゼミで、教授が懐疑的な表情で質問した。

「必要というより...」

　雅史が言葉を選んでいる。昨日から準備した新しい研究方針の説明。私も隣で緊張していた。

「初学者の感情的反応を『無視しない』設計が必要だと考えています」

「具体的には？」

「まず、エラーメッセージの改善から始めます。技術的には既存のPythonインタープリタのラッパーで実現可能です」

　雅史がコードを表示した。

```python
class EmotionalPythonInterpreter:
    def __init__(self):
        self.error_count = {}
        self.last_error_time = None
        
    def handle_error(self, error_type, error_msg):
        # エラーの頻度を記録
        if error_type not in self.error_count:
            self.error_count[error_type] = 0
        self.error_count[error_type] += 1
```

「これの何が『感情的』なんだ？」

　教授の質問は鋭い。


◇◇◇


「従来のエラーメッセージは一方的です」

　雅史が説明を続ける。

「でも、同じエラーでも状況によって伝え方を変えるべきでは？」

「状況？」

「初回のNameErrorと、10回目のNameErrorでは、学習者の心理状態が違います」

　私は思わず頷いた。そうだ、繰り返しエラーが出ると焦りが募る。

「具体例を見せてください」

　雅史が準備していたデモを起動した。

```python
# 従来のエラー
>>> print(hello)
NameError: name 'hello' is not defined

# 新しいアプローチ（初回）
>>> print(hello)
おっと！ 'hello' という名前が見つかりません。
もしかして：
• 文字列なら: print("hello")
• 変数なら: hello = "何か" を先に書く
```

「ふむ」

　教授が興味を示した。

「これが10回目なら？」

```python
# 10回目のNameError
>>> print(test)
また同じタイプのエラーですね。大丈夫、一緒に解決しましょう。

NameErrorは「名前が定義されていない」という意味です。
よくある原因：
1. 変数名のタイプミス（tset → test？）
2. 定義し忘れ
3. スコープの問題

一度深呼吸して、変数名を確認してみませんか？
```


◇◇◇


「これは...エラーメッセージというより、メンタリングシステムだな」

　教授の表現に、雅史が頷いた。

「はい。技術的にはエラーハンドリングの拡張ですが、目的は学習者の心理的サポートです」

「実装の難易度は？」

「基本機能なら1ヶ月で実装可能です。Pythonの例外処理をフックして、カスタムメッセージを表示するだけなので」

　私は手を挙げた。

「あの、質問していいですか？」

「どうぞ、柳原さん」

「これって、エラーを『恐怖』から『対話』に変える試みですよね？」

　雅史が微笑んだ。

「その通りです。エラーは敵じゃない。学習のパートナーとして」

　教授が考え込んでいる。

「理論的には面白い。だが、これで本当に恐怖が軽減されるのか？」

「実は、予備実験を行いました」

　雅史が新しいスライドを表示した。


◇◇◇


「被験者10名。全員Scratch経験者で、Python初心者」

　グラフが表示される。

「従来のエラーメッセージ群と、改善版での比較です」

　結果は明確だった。

- 学習継続率：45% → 80%
- エラー解決時間：平均8.2分 → 4.5分
- 「恐怖を感じた」：9名 → 3名

「特に興味深いのは、自由記述欄です」

　雅史がコメントを表示した。

『エラーが出ても、怒られてる感じがしなかった』
『次に何をすればいいか分かりやすい』
『プログラミングって対話なんだと感じた』

　教授が身を乗り出した。

「サンプル数は少ないが...有意な差だ」

「はい。ただし、これは第一歩に過ぎません」

　雅史が次のスライドに進んだ。

「本当の課題は、より深いレベルでの感情理解です」

　画面に新しい図が現れた。

『感情認識型プログラミング環境の3層構造』
1. 表層：エラーメッセージの改善
2. 中層：学習者の状態推定
3. 深層：個別最適化された学習パス

「現在は表層のみ。でも将来的には...」


◇◇◇


「ちょっと待て」

　教授が手を挙げた。

「それは理想論すぎないか？個別最適化なんて、AI研究でも難しい」

「おっしゃる通りです」

　雅史は素直に認めた。

「だから、現実的なアプローチから始めます。エラーメッセージの改善だけでも、大きな効果がある」

　私は思い切って発言した。

「小説でも同じです。読者全員に最適化はできない。でも、多くの人に伝わる書き方はある」

　教授が私を見た。

「つまり？」

「80%の初学者に効果があれば、それは成功では？完璧を求めすぎると、何も生まれません」

　雅史が補足した。

「柳原さんの言う通りです。我々の目標は『完璧な言語』ではなく『より多くの人が学べる環境』です」

　教授が深く頷いた。

「なるほど。現実的だ」

　そして、意外な言葉が続いた。

「花咲君、このプロジェクト、正式に進めなさい。予算も付けよう」

「本当ですか？」

「ただし条件がある」

　教授の目が鋭くなった。

「3ヶ月以内に、実用レベルのプロトタイプを作ること。そして...」

　私たちを交互に見て、

「二人で論文を書くこと。技術と人文、両方の視点が必要だ」

　研究室を出た後、廊下で雅史と顔を見合わせた。

「やった...！」

「うん。でも、これからが本番だ」

　現実的な一歩。でも確実な一歩。

　恐怖を完全になくすことはできない。でも、和らげることはできる。

　それが、私たちの見つけた答えだった。


◇◇◇


　その夜、研究室で実装を始めた。

「まず、Pythonの標準エラーをキャッチする仕組みから」

　雅史がキーボードを叩く。私は隣で見守っていた。

```python
import sys
import traceback
from datetime import datetime

class KindErrorHandler:
    def __init__(self):
        self.error_history = []
        self.start_time = datetime.now()
        
    def __call__(self, exc_type, exc_value, exc_traceback):
        # エラーの記録
        error_info = {
            'type': exc_type.__name__,
            'message': str(exc_value),
            'time': datetime.now(),
            'count': len([e for e in self.error_history 
                         if e['type'] == exc_type.__name__])
        }
        self.error_history.append(error_info)
```

「これで、エラーの履歴を追跡できる」

「すごい...でも、これをどう使うんですか？」

「見てて」

　雅史が続きを書いた。

```python
def generate_message(self, error_info):
    error_type = error_info['type']
    count = error_info['count']
    
    # 初回のエラー
    if count == 0:
        return self.first_time_message(error_type)
    # 繰り返しエラー
    elif count < 3:
        return self.repeated_message(error_type, count)
    # 頻発エラー
    else:
        return self.frequent_message(error_type)
```

「エラーの回数で、メッセージを変える」

「なるほど！」

　私は理解した。同じエラーでも、状況に応じて対応を変える。まるで、読者の反応を見ながら書く小説のように。

「優美、メッセージの文面、一緒に考えてくれる？」

「もちろん！」

　私たちは深夜まで、一つ一つのメッセージを推敲した。

「SyntaxErrorの初回は...『構文に小さな問題があるようです』」

「『小さな』がいいね。大したことないって安心させる」

「2回目は？」

「『また同じ箇所でつまずいていますね。一緒に見てみましょう』」

「『一緒に』がポイント」

　気がつけば、窓の外が白み始めていた。

「できた...」

　画面には、30種類以上のエラーに対する、段階的なメッセージ集が完成していた。

　これは理想の解決策じゃない。

　でも、確実に誰かを救える一歩。

　そして何より、技術と言葉が融合した、私たちにしか作れないものだった。